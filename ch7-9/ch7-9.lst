     1                                  ; Chapter 7, exercise 9
     2                                  ; Iteratively find the nth Fibonacci number
     3                                  ;
     4                                  ; For example, the 10th Fibonacci number is 55
     5                                  ;              the 5th Fibonacci number is 5
     6                                  
     7                                  DEFAULT REL
     8                                  
     9                                  ; *********************
    10                                  
    11                                  section     .data
    12                                  
    13                                  ; Constants
    14                                  SUCCESS     equ     0
    15                                  SYS_exit    equ     0x2000001
    16                                  
    17                                  ; Variables
    18 00000000 05                      n           db      5                  ; Argument to fib(n)
    19 00000001 00000000                fibnum      dd      0                   ; The nth Fibonacci number
    20                                  
    21                                  ; *********************
    22                                  
    23                                  section     .text
    24                                  global _start
    25                                  _start:
    26                                  
    27                                                                          ; fib(n) will recurse n times
    28 00000000 8A0D(00000000)              mov     cl, [n]
    29 00000006 88CA                        mov     dl, cl                      ; Copy cl to dl, which will be used for calling fib(n) recursively
    30                                  
    31                                  fib:                                    ; fib(n) function
    32                                  
    33 00000008 FECA                        dec     dl
    34 0000000A 80FA01                      cmp     dl, 1
    35 0000000D 740A                        je      base
    36 0000000F 75F7                        jne     fib
    37                                  
    38                                  fibLoopback:
    39                                  
    40 00000011 88CA                        mov     dl, cl
    41 00000013 FECA                        dec     dl                          ; Reset dl
    42 00000015 E2F1                        loop    fib
    43 00000017 EB09                        jmp     exit
    44                                  
    45                                  base:                                   ; Base case
    46                                  
    47 00000019 8305(01000000)01            add     dword [fibnum], 1
    48 00000020 EBEF                        jmp     fibLoopback
    49                                  
    50                                  exit:
    51 00000022 B801000002                  mov     rax, SYS_exit
    52 00000027 BF00000000                  mov     rdi, SUCCESS
    53 0000002C 0F05                        syscall
