     1                                  ; Chapter 12, exercise 2
     2                                  ; Implement the stats2 function that does the following:
     3                                  ;   * Finds the median of a list of numbers
     4                                  ;   * Finds the min and max of a list of numbers
     5                                  ;   * Finds the sum of a list of numbers
     6                                  ;   * Finds the average of a list of numbers
     7                                  
     8                                  default rel
     9                                  
    10                                  ; HLL call:
    11                                  ;   stats2(arr, len, min, med, max, sum, ave);
    12                                  ; -----
    13                                  ; Arguments:
    14                                  ;   arr, address        – rdi
    15                                  ;   len, dword value    – esi
    16                                  ;   min, address        - rdx
    17                                  ;   med, address        - rcx
    18                                  ;   max, address        - r8
    19                                  ;   sum, address        - r9
    20                                  ;   ave, address        - rbp + 16
    21                                  
    22                                  section     .text
    23                                  global stats2
    24                                  stats2:
    25                                  
    26 00000000 53                          push    rbx
    27 00000001 4154                        push    r12
    28 00000003 4155                        push    r13
    29                                  
    30 00000005 BB02000000                  mov     rbx, 2
    31                                  
    32 0000000A 41BA00000000                mov     r10, 0
    33 00000010 4989D3                      mov     r11, rdx                ; Save addr of rdx
    34 00000013 89F0                        mov     eax, esi
    35 00000015 BA00000000                  mov     rdx, 0
    36 0000001A F7F3                        div     ebx
    37 0000001C 89C3                        mov     ebx, eax                ; ebx contains the index of the median
    38 0000001E B800000000                  mov     eax, 0                  ; Now eax will store the sum
    39                                  
    40                                  iter:
    41                                  
    42 00000023 468B2497                    mov     r12d, [rdi + r10*4]
    43 00000027 4154                        push    r12                     ; push since r12 could be modified in setMed
    44 00000029 4401E0                      add     eax, r12d
    45 0000002C 4939DA                      cmp     r10, rbx
    46 0000002F 7416                        je      setMed
    47                                  
    48                                  checkMin:
    49                                  
    50 00000031 415C                        pop     r12
    51 00000033 453923                      cmp     [r11], r12d
    52 00000036 7F3B                        jg      setMin
    53                                  
    54                                  checkMax:
    55                                  
    56 00000038 453920                      cmp     [r8], r12d
    57 0000003B 7C3B                        jl      setMax
    58                                  
    59                                  endIter:
    60                                  
    61 0000003D 49FFC2                      inc     r10
    62 00000040 4939F2                      cmp     r10, rsi
    63 00000043 75DE                        jne     iter
    64 00000045 EB36                        jmp     exit
    65                                  
    66                                  setMed:
    67                                  
    68 00000047 4883FA01                    cmp     rdx, 1                  ; If remainder is 1, then the med is the middle number
    69 0000004B 7402                        je      setMedOdd
    70 0000004D EB05                        jmp     setMedEven
    71                                  
    72                                  setMedOdd:
    73                                  
    74 0000004F 448921                      mov     [rcx], r12d
    75 00000052 EBDD                        jmp     checkMin
    76                                  
    77                                  setMedEven:
    78                                  
    79 00000054 50                          push    rax
    80 00000055 49FFCA                      dec     r10
    81 00000058 468B2C97                    mov     r13d, [rdi + r10*4]
    82 0000005C 49FFC2                      inc     r10
    83 0000005F 4501EC                      add     r12d, r13d
    84 00000062 99                          cdq
    85 00000063 4489E0                      mov     eax, r12d
    86 00000066 BB02000000                  mov     rbx, 2
    87 0000006B 48F7F3                      div     rbx
    88 0000006E 8901                        mov     [rcx], eax
    89 00000070 58                          pop     rax
    90 00000071 EBBE                        jmp     checkMin
    91                                  
    92                                  setMin:
    93                                  
    94 00000073 4D8923                      mov     [r11], r12
    95 00000076 EBC0                        jmp     checkMax
    96                                  
    97                                  setMax:
    98                                  
    99 00000078 4D8920                      mov     [r8], r12
   100 0000007B EBC0                        jmp     endIter
   101                                  
   102                                  exit:
   103                                  
   104 0000007D 418901                      mov     [r9], eax
   105                                  
   106 00000080 415D                        pop     r13
   107 00000082 415C                        pop     r12
   108 00000084 5B                          pop     rbx
   109 00000085 C3                          ret
