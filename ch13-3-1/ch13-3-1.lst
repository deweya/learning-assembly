     1                                  ; Print messages to the console
     2                                  
     3                                  default rel
     4                                  
     5                                  %define     SUCCESS         0
     6                                  %define     SYS_exit        0x2000001
     7                                  %define     SYS_write       0x2000004
     8                                  
     9                                  %define     STDOUT          1
    10                                  
    11                                  %define     LF              10
    12                                  %define     NULL            0
    13                                  
    14                                  ; ***************************
    15                                  
    16                                  section     .data
    17                                  
    18 00000000 48656C6C6F2C20776F-     message1    db      "Hello, world!", LF, NULL
    18 00000009 726C64210A00       
    19 0000000F 596F2C20796F2C2079-     message2    db      "Yo, yo, yo!", LF, NULL
    19 00000018 6F210A00           
    20 0000001C 4865792C207927616C-     message3    db      "Hey, y'all!", LF, NULL
    20 00000025 6C210A00           
    21                                  
    22                                  ; ***************************
    23                                  
    24                                  section     .text
    25                                  global _start
    26                                  _start:
    27                                  
    28 00000000 488D3D(00000000)            lea     rdi, [message1]
    29 00000007 E80C000000                  call    printString
    30                                  
    31                                  exit:
    32 0000000C B801000002                  mov     rax, SYS_exit
    33 00000011 BF00000000                  mov     rdi, SUCCESS
    34 00000016 0F05                        syscall
    35                                  
    36                                  ; -----
    37                                  ; Prints a string to the console
    38                                  ; Args:
    39                                  ;   * rdi - message (address)
    40                                  ; Syscall:
    41                                  ;   ssize_t
    42                                  ;   write(int fildes, const void *buf, size_t nbyte);
    43                                  ;         rdi         rsi              rdx
    44                                  
    45                                  global printString
    46                                  printString:
    47                                  
    48 00000018 B804000002                  mov     rax, SYS_write
    49 0000001D BA00000000                  mov     rdx, 0                  ; 3rd arg
    50 00000022 4889FE                      mov     rsi, rdi                ; 2nd arg
    51 00000025 BF01000000                  mov     rdi, STDOUT             ; 1st arg
    52                                  
    53 0000002A 4989F2                      mov     r10, rsi                ; use r10 to iterate so we don't knock rsi off
    54                                  
    55                                  getLength:
    56                                  
    57                                      ; Get the length of the string so we know how many bytes to read from the buffer
    58                                  
    59 0000002D 41803A00                    cmp     byte [r10], NULL
    60 00000031 7408                        je      doPrint
    61 00000033 49FFC2                      inc     r10                     ; increase the pointer one byte
    62 00000036 48FFC2                      inc     rdx                     ; increase the size of nbytes
    63 00000039 EBF2                        jmp     getLength
    64                                  
    65                                  doPrint:
    66                                  
    67 0000003B 0F05                        syscall
    68 0000003D C3                          ret
